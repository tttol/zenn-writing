---
title: "Amazon S3のモックアプリを作りました"
emoji: "🙆"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [aws]
published: false
---
# はじめに
Amazon S3のモックアプリケーション「MOS3」を開発しました。モススリーと読みます。
[LocalStack](https://www.localstack.cloud/)のように、ローカル環境で動作するS3ライクなアプリケーションになります。

MOS3はブラウザ上でファイル操作ができるGUIアプリケーションです。CLIから`aws s3 cp`等のコマンドを打つことなく、ファイルアップロードが可能です。
![alt text](/images/mos3.png)

ソースコードはこちらです。
https://github.com/tttol/mos3

# 開発背景とコンセプト
### モチベーション
MOS3の開発モチベーションは以下です。
- ローカル環境開発時にブラウザからS3を操作したかった（普段はLocalStackを使ってCLIからS3を操作していた）
- LocalStackにResource BrowserというGUI機能もあるが、多機能すぎて自分には合わなかった。あとUIがいまいちしっくり来なかった。

こうしたモチベーションのもと、「納得いくものを自分で作ればいいのでは？！」という発想になりました。

# 機能
### ローカル環境でS3の代わりとして利用可能
MOS3は http://localhost:33333/s3 で起動します。
※インストール方法の詳細は[README](https://github.com/tttol/mos3?tab=readme-ov-file#install)を参照ください

MOS3はそれ単体でS3ライクなローカルファイルサーバーとして利用できますが、AWS SDKからのリクエストを受け付けることも可能です。
例えば、AWS SDK for Javaの[getObjetcts](https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/AmazonS3Client.html#getObject-com.amazonaws.services.s3.model.GetObjectRequest-)メソッドからMOS3にリクエストを送ると、指定されたkeyのオブジェクトをレスポンスとして返却します。

AWS SDK for JavaからMOS3を呼び出す場合、`S3Client`のエンドポイントにhttp://localhost:3333を指定する必要があります。以下はそのコードサンプルです。
```java
S3Client s3 = S3Client.builder()
        .region(region)
        .endpointOverride(new URI("http://localhost:3333"))
        .build();
```

:::message
endpointにlocalhostを指定する際、パススタイルアクセスを有効化しないと正しく動作しない場合があります。
```java
S3Configuration s3Configuration = S3Configuration.builder()
        .pathStyleAccessEnabled(true) // enable path style access
        .build();

S3Client s3 = S3Client.builder()
        .region(region)
        .endpointOverride(new URI("http://localhost:3333"))
        .serviceConfiguration(s3Configuration)
        .build();
```
:::

### ブラウザからファイル操作
ディレクトリ移動、ファイルUP、ディレクトリ作成をGIFで説明する。
ファイルDL機能も実装してGIFを作る

### PCのローカルディレクトリとの紐づけ


# 将来実装予定の機能
### Java以外のAWS SDKリクエストの受付
私はJavaをよく使うので、AWS SDK for Javaからのリクエストは基本的に受け付けるよう実装しています。
逆に、Java以外のSDKに関しては動作するものとしないものがあり、そこの動作は保証できてません。
ゆくゆくはJava以外のSDKリクエストも受け付けるよう拡張したいですが、これは将来の課題です。

### AWS CLIリクエストの受付
AWS CLIからのls, mb, cp, rmなどのコマンドリクエスト受付については、まだ実装途中です。
最低限lsとcpは受け付けますが、それ以外のコマンドの受付は将来の課題です。

# さいごに
オチを書く